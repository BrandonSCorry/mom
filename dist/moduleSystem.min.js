/**
 * moduleSystem
 * Dynamic Loading of Javascript based on DOM elements
 * @version v1.3.0 - 2015-03-26 * @link 
 * @author Eder Alexander <eder.alexan@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){function d(a,b){"use strict";var c,d,e,f=a.length;for(c=0;f>c&&(d=a[c],!(e=b(c,d)));c++);}function e(a,b){"use strict";var c,d,e=a.length,f=!1;for(c=0;e>c;c++)if(d=a[c],d===b){f=!0;break}return f}function f(a){"use strict";return"[object Array]"===toString.call(a)}function g(a,b){"use strict";var c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],e=b(c,d)))break}function h(){"use strict";var a=arguments[0];return d(arguments,function(b,c){b>0&&g(c,function(b,c){a[b]=c})}),a}function i(){"use strict";function a(a){h(e,a)}function c(){return e}var d={rootNode:b,defaultScope:r.scope.multiInstance,settingsSelector:'script[type="%moduleName%/settings"]',attribute:"modules",selector:"[%attribute%]",logger:console.error.bind(console)},e=d;return{get:c,mergeWith:a}}function j(a){"use strict";if("string"!=typeof a)throw new Error("Name missing");return{name:a}}function k(a){"use strict";var b=j(a);return b.type=r.type.creator,b.settings=c,b.dependencies=[],b.creator=c,b}function l(a,b,c){"use strict";function e(){function e(){var e=c.selector.replace(/%attribute%/g,c.attribute),g=c.rootNode.querySelectorAll(e);b.initEagerSingletons(),d(g,function(a,b){f(b)}),b.provisionFinished(),a.provisionFinished()}function f(b){a.provisionModule(b)}e()}return{initModulePage:e}}function m(a){"use strict";function b(b){function d(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");i.creator=a,g()}function e(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return i.settings=a,{dependencies:h,creator:d}}function g(){a.addModuleDescriptor(i)}function h(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return i.dependencies=a,{settings:e,creator:d}}var i=k(b);return{settings:e,dependencies:h,creator:d}}return b}function n(a,b,e){"use strict";function f(a){o[a.name]=a}function g(a){var b=a.getAttribute(e.attribute),c=b.split(",");d(c,function(b,c){c=c.trim(),i(a,c)})}function i(b,d){function f(a){var b=a;console.group&&console.group(),e.logger(a.message,"while loading module",g);do e.logger("... while loading part",b.descriptor),b=b.cause;while(b.cause!==c);e.logger("caused by:",b.stack),console.groupEnd&&console.groupEnd()}var g,h;try{o.hasOwnProperty(d)?(g=o[d],h=a.getParts(g.dependencies),j(b,g,h)):e.logger("Module",d,"not registered but found in dom")}catch(i){switch(i.name){case"SettingsParseException":e.logger("Wrong formatted JSON in DOM for module",g.name,"message:",i.message);break;case"PartCreationException":f(i);break;default:e.logger("Error during provision of module",g,i.stack)}}}function j(a,d,e){var f,g,i=e,j=k(a,d.name);(d.settings!==c||j!==c)&&(f=h({},d.settings,j),i.unshift(f)),i.unshift(a),g=d.creator.apply(d,i),g===c&&(g={}),n.push(g),b.add(g)}function k(a,b){var c,d,f=e.settingsSelector.replace(/%moduleName%/g,b),g=a.querySelector(f);if(null!==g){c=g.innerHTML;try{d=JSON.parse(c)}catch(h){throw new m(h.message)}}return d}function l(){d(n,function(a,b){var c=b.postConstruct;"function"==typeof c&&c.call(b)})}function m(a){Error.captureStackTrace&&Error.captureStackTrace(this),this.name="SettingsParseException",this.message=a}var n=[],o={};return m.prototype=Error.prototype,{provisionModule:g,provisionFinished:l,addModuleDescriptor:f}}function o(a,b){"use strict";function d(a){var b=j(a);return b.type=r.type.returns,b.scope=i,b.returns=c,b}function e(a){var c=k(a);return c.scope=b.defaultScope,c}function g(b){function g(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");o().creator=a,p()}function h(a){if(a===c)throw new Error("You have to pass the returns as one of these object types: string|integer|float|boolean|object|function|Array");q=d(b),q.returns=a,p()}function j(a){if(i!==a&&l!==a&&m!==a)throw new Error("You have to pass the scope as one of these: lazy-singleton|eager-singleton|multi-instance");var b=o();return a!==c&&(b.scope=a),{settings:k,dependencies:n,creator:g,returns:h}}function k(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return o().settings=a,{dependencies:n,creator:g,scope:j}}function n(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return o().dependencies=a,{settings:k,creator:g,scope:j}}function o(){return q===c&&(q=e(b)),q}function p(){a.addPartDescriptor(q)}var q;return{settings:k,dependencies:n,creator:g,returns:h,scope:j}}var h=r.scope,i=h.lazySingleton,l=h.eagerSingleton,m=h.multiInstance;return g}function p(a){"use strict";function b(a){w[a.name]=a}function e(){var a=[];g(w,function(b,c){c.scope===r.scope.eagerSingleton&&a.push(c.name)}),f(a,!0)}function f(b,c){var e=[];return d(b,function(b,d){try{var f=h(d);e.push(f)}catch(g){if(!c)throw g;a.logger(g)}}),e}function h(a){var b,c,d;if(!w.hasOwnProperty(a))throw new Error("tried to load "+a+" but was not registered");return b=w[a],c=i(b.scope),d=c(b),d}function i(a){switch(a){case r.scope.multiInstance:return j;case r.scope.lazySingleton:case r.scope.eagerSingleton:return k;default:throw new Error("unknown scope ["+a+"]")}}function j(a){var b,c=l(a.type);return b=c(a),v.push(b),b}function k(a){var b=a.name,d=u[b];return d===c&&(d=j(a),u[b]=d),d}function l(a){switch(a){case r.type.returns:return m;case r.type.creator:return n;default:throw new Error("unknown type ["+a+"]")}}function m(a){return a.returns}function n(a){var b,d,e,g;try{return b=a.dependencies,d=f(b),e=d,a.settings!==c&&e.unshift(a.settings),g=a.creator.apply(a,e),g===c&&(g={}),g}catch(h){switch(h.name){case"CircularDependencyException":throw h;case"RangeError":throw h;default:throw new s(a,h)}}}function o(){g(v,function(a,b){p(b)})}function p(b){if("function"==typeof b.postConstruct){try{b.postConstruct()}catch(c){a.logger("Exception while calling postConstruct",c)}delete b.postConstruct}}function q(a){var b=h(a);return p(b),b}function s(a,b){Error.captureStackTrace&&Error.captureStackTrace(this),this.name="PartCreationException",this.cause=b,this.descriptor=a}function t(){Error.captureStackTrace&&Error.captureStackTrace(this),this.name="CircularDependencyException",this.message="circular dependency detected check parts"}var u={},v=[],w={};return s.prototype=Error.prototype,t.prototype=Error.prototype,{initEagerSingletons:e,provisionPart:q,getParts:f,provisionFinished:o,addPartDescriptor:b}}function q(){"use strict";function a(a){if(a===c)throw new Error("Published event cannot be undefined");var e="on"+a.name;d(i,function(d,f){a.name!==c&&b(f,e,a),b(f,h,a)})}function b(a,b,c){var d=a[b];"function"==typeof d&&d.call(a,c)}function f(a){if(a===c)throw new Error("Component to be registered is undefined");if(e(i,a))throw new Error("Component is already registered");i.push(a)}function g(){i=[]}var h="onEvent",i=[];return{publish:a,add:f,reset:g}}var r={scope:{lazySingleton:"lazy-singleton",eagerSingleton:"eager-singleton",multiInstance:"multi-instance"},type:{returns:"returns",creator:"creator"}};moduleSystem=function(a,b,d,e,f,g,i){"use strict";function j(){function k(a){a!==c&&l.mergeWith(a),t.initModulePage()}var l=a(),m=l.get(),n=f(m),o=i(),p=g(n,o,m),q=d(n,m),s=b(p),t=e(p,n,m);return q("event-bus").returns(o),q("eventBus").creator(function(){return console.warn('partName "eventBus" deprecated use "event-bus" instead'),o}),h({createPart:q,createModule:s,initModulePage:k,newInstance:j,getPart:n.provisionPart},r)}return j()}(i,m,o,l,p,n,q)}(window,document);