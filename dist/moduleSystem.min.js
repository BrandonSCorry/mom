/**
 * moduleSystem
 * Dynamic Loading of Javascript based on DOM elements
 * @version v1.3.0 - 2015-03-24 * @link 
 * @author Eder Alexander <eder.alexan@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){function d(a,b){"use strict";var c,d,e,f=a.length;for(c=0;f>c&&(d=a[c],!(e=b(c,d)));c++);}function e(a,b){"use strict";var c,d,e=a.length,f=!1;for(c=0;e>c;c++)if(d=a[c],d===b){f=!0;break}return f}function f(a){"use strict";return"[object Array]"===toString.call(a)}function g(a,b){"use strict";var c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],e=b(c,d)))break}function h(){"use strict";var a=arguments[0];return d(arguments,function(b,c){b>0&&g(c,function(b,c){a[b]=c})}),a}function i(){"use strict";function a(a){h(e,a)}function c(){return e}var d={rootNode:b,defaultScope:r.scope.multiInstance,settingsSelector:'script[type="%moduleName%/settings"]',attribute:"modules",selector:"[%attribute%]"},e=d;return{get:c,mergeWith:a}}function j(a){"use strict";if("string"!=typeof a)throw new Error("Name missing");return{name:a}}function k(a){"use strict";var b=j(a);return b.type=r.type.creator,b.settings=c,b.dependencies=[],b.creator=c,b}function l(a,b,c){"use strict";function e(){function e(){var e=c.selector.replace(/%attribute%/g,c.attribute),g=c.rootNode.querySelectorAll(e);b.initEagerSingletons(),d(g,function(a,b){f(b)}),b.provisionFinished(),a.provisionFinished()}function f(b){a.provisionModule(b)}e()}return{initModulePage:e}}function m(a){"use strict";function b(b){function d(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");i.creator=a,g()}function e(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return i.settings=a,{dependencies:h,creator:d}}function g(){a.addModuleDescriptor(i)}function h(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return i.dependencies=a,{settings:e,creator:d}}var i=k(b);return{settings:e,dependencies:h,creator:d}}return b}function n(a,b,e){"use strict";function f(a){n[a.name]=a}function g(a){var b=a.getAttribute(e.attribute),c=b.split(",");d(c,function(b,c){c=c.trim(),i(a,c)})}function i(b,c){var d,e;if(!n.hasOwnProperty(c))throw new Error("Module "+c+" not registered but found in dom");if(d=n[c],e=a.getParts(d.dependencies),e.length!==d.dependencies.length)throw new Error("Required Parts Missing from "+c+" dependencies: "+JSON.stringify(d.dependencies));j(b,d,e)}function j(a,d,e){var f,g,i=e,j=k(a,d.name);(d.settings!==c||j!==c)&&(f=h({},d.settings,j),i.unshift(f)),i.unshift(a),g=d.creator.apply(d,i),g===c&&(g={}),m.push(g),b.add(g)}function k(a,b){var c,d,f=e.settingsSelector.replace(/%moduleName%/g,b),g=a.querySelector(f);return null!==g&&(c=g.innerHTML,d=JSON.parse(c)),d}function l(){d(m,function(a,b){var c=b.postConstruct;"function"==typeof c&&c.call(b)})}var m=[],n={};return{provisionModule:g,provisionFinished:l,addModuleDescriptor:f}}function o(a,b){"use strict";function d(a){var b=j(a);return b.type=r.type.returns,b.scope=r.scope.lazySingleton,b.returns=c,b}function e(a){var c=k(a);return c.scope=b.defaultScope,c}function f(b){function f(a){k().creator=a,l()}function g(a){m=d(b),m.returns=a,l()}function h(a){var b=k();return a!==c&&(b.scope=a),{settings:i,dependencies:j,creator:f,returns:g}}function i(a){return k().settings=a,{dependencies:j,creator:f,scope:h}}function j(a){return k().dependencies=a,{settings:i,creator:f,scope:h}}function k(){return m===c&&(m=e(b)),m}function l(){a.addPartDescriptor(m)}var m;return{settings:i,dependencies:j,creator:f,returns:g,scope:h}}return f}function p(){"use strict";function a(a){t[a.name]=a}function b(){var a=[];g(t,function(b,c){c.scope===r.scope.eagerSingleton&&a.push(c.name)}),e(a)}function e(a){var b=[];return d(a,function(a,c){b.push(f(c))}),b}function f(a){var b,c,d;if(!t.hasOwnProperty(a))throw new Error("tried to load "+a+" but was not registered");return b=t[a],c=h(b.scope),d=c(b),d}function h(a){switch(a){case r.scope.multiInstance:return i;case r.scope.lazySingleton:case r.scope.eagerSingleton:return j;default:throw new Error("unknown scope ["+a+"]")}}function i(a){var b,c=k(a.type);return b=c(a),s.push(b),b}function j(a){var b=a.name,d=q[b];return d===c&&(d=i(a),q[b]=d),d}function k(a){switch(a){case r.type.returns:return l;case r.type.creator:return m;default:throw new Error("unknown type ["+a+"]")}}function l(a){return a.returns}function m(a){var b,d,f,g;return b=a.dependencies,d=e(b),f=d,a.settings!==c&&f.unshift(a.settings),g=a.creator.apply(a,f),g===c&&(g={}),g}function n(){g(s,function(a,b){o(b)})}function o(a){"function"==typeof a.postConstruct&&(a.postConstruct(),delete a.postConstruct)}function p(a){var b=f(a);return o(b),b}var q={},s=[],t={};return{initEagerSingletons:b,provisionPart:p,getParts:e,provisionFinished:n,addPartDescriptor:a}}function q(){"use strict";function a(a){if(a===c)throw new Error("Published event cannot be undefined");var e="on"+a.name;d(i,function(d,f){a.name!==c&&b(f,e,a),b(f,h,a)})}function b(a,b,c){var d=a[b];"function"==typeof d&&d.call(a,c)}function f(a){if(a===c)throw new Error("Component to be registered is undefined");if(e(i,a))throw new Error("Component is already registered");i.push(a)}function g(){i=[]}var h="onEvent",i=[];return{publish:a,add:f,reset:g}}var r={scope:{lazySingleton:"lazy-singleton",eagerSingleton:"eager-singleton",multiInstance:"multi-instance"},type:{returns:"returns",creator:"creator"}};moduleSystem=function(a,b,d,e,f,g,i){"use strict";function j(){function k(a){a!==c&&l.mergeWith(a),t.initModulePage()}var l=a(),m=l.get(),n=f(),o=i(),p=g(n,o,m),q=d(n,m),s=b(p),t=e(p,n,m);return q("event-bus").returns(o),q("eventBus").creator(function(){return console.warn('partName "eventBus" deprecated use "event-bus" instead'),o}),h({createPart:q,createModule:s,initModulePage:k,newInstance:j,getPart:n.provisionPart},r)}return j()}(i,m,o,l,p,n,q)}(window,document);