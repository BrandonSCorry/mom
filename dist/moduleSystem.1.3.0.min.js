/**
 * moduleSystem
 * Dynamic Loading of Javascript based on DOM elements
 * @version v1.3.0 - 2015-04-07 * @link 
 * @author Eder Alexander <eder.alexan@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){function d(a){"use strict";Error.captureStackTrace&&Error.captureStackTrace(this),this.name="SettingsParseException",this.message=a}function e(a,b){"use strict";var c,e,f=a.querySelector(b);if(null!==f){c=f.innerHTML;try{e=JSON.parse(c)}catch(g){throw new d(g.message)}}return e}function f(a,b){"use strict";var c=!1;return s(a,function(a){return a===b?(c=!0,!0):void 0}),c}function g(a){"use strict";return"[object Array]"===Object.prototype.toString.call(a)}function h(a,b){"use strict";var c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],e=b(d,c)))break}function i(a){"use strict";return s(arguments,function(b,c){c>0&&h(b,function(b,c){a[c]=b})}),a}function j(){"use strict";function a(a){i(e,a)}function c(){return e}var d={rootNode:b,defaultScope:u.scope.multiInstance,moduleSettingsSelector:'script[type="%moduleName%/settings"]',partSettingsSelector:'head script[type="%partName%/settings"]',attribute:"modules",selector:"[%attribute%]",logger:function(){console.error&&console.error.apply&&console.error.apply(console,arguments)}},e=d;return{get:c,mergeWith:a}}function k(a){"use strict";if("string"!=typeof a)throw new Error("Name missing");return{name:a}}function l(a){"use strict";var b=k(a);return b.type=u.type.creator,b.settings=c,b.dependencies=[],b.creator=c,b}function m(a,b,c){"use strict";function d(){function d(){var d=c.selector.replace(/%attribute%/g,c.attribute),f=c.rootNode.querySelectorAll(d);b.initEagerSingletons(),s(f,function(a){e(a)}),b.provisionFinished(),a.provisionFinished()}function e(b){a.provisionModule(b)}d()}return{initModulePage:d}}function n(a){"use strict";function b(b){function d(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");i.creator=a,f()}function e(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return i.settings=a,{dependencies:h,creator:d}}function f(){a.addModuleDescriptor(i)}function h(a){if(a!==c&&!g(a))throw new Error("You have to pass the dependencies as an Array");return i.dependencies=a,{settings:e,creator:d}}var i=l(b);return{settings:e,dependencies:h,creator:d}}return b}function o(a,b,d){"use strict";function f(a){m[a.name]=a}function g(a){var b=a.getAttribute(d.attribute),c=b.split(",");s(c,function(b){b=t(b),h(a,b)})}function h(b,e){function f(a){var b=a;console.group&&console.group(),d.logger(a.message,"while loading module",g);do d.logger("... while loading part",b.descriptor),b=b.cause;while(b.cause!==c);d.logger("caused by:",b.stack),console.groupEnd&&console.groupEnd()}var g,h;try{m.hasOwnProperty(e)?(g=m[e],h=a.getParts(g.dependencies),j(b,g,h)):d.logger("Module",e,"not registered but found in dom")}catch(i){switch(i.name){case"SettingsParseException":d.logger("Wrong formatted JSON in DOM for module",g.name,"message:",i.message);break;case"PartCreationException":f(i);break;default:d.logger("Error during provision of module",g,i.stack)}}}function j(a,f,g){var h,j=g,k=e(a,d.moduleSettingsSelector.replace(/%moduleName%/g,f.name)),m={};(f.settings!==c||k!==c)&&(i(m,f.settings,k),j.unshift(m)),j.unshift(a),h=f.creator.apply(f,j),h===c&&(h={}),l.push(h),b.add(h)}function k(){s(l,function(a){if("function"==typeof a.postConstruct)try{a.postConstruct()}catch(b){d.logger("Exception while calling postConstruct",b)}})}var l=[],m={};return{provisionModule:g,provisionFinished:k,addModuleDescriptor:f}}function p(a,b){"use strict";function d(a){var b=k(a);return b.type=u.type.returns,b.scope=i,b.returns=c,b}function e(a){var c=l(a);return c.scope=b.defaultScope,c}function f(b){function f(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");o().creator=a,p()}function h(a){if(a===c)throw new Error("You have to pass the returns as one of these object types: string|integer|float|boolean|object|function|Array");q=d(b),q.returns=a,p()}function k(a){if(i!==a&&j!==a&&m!==a)throw new Error("You have to pass the scope as one of these: lazy-singleton|eager-singleton|multi-instance");var b=o();return a!==c&&(b.scope=a),{settings:l,dependencies:n,creator:f,returns:h}}function l(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return o().settings=a,{dependencies:n,creator:f,scope:k}}function n(a){if(a!==c&&!g(a))throw new Error("You have to pass the dependencies as an Array");return o().dependencies=a,{settings:l,creator:f,scope:k}}function o(){return q===c&&(q=e(b)),q}function p(){a.addPartDescriptor(q)}var q;return{settings:l,dependencies:n,creator:f,returns:h,scope:k}}var h=u.scope,i=h.lazySingleton,j=h.eagerSingleton,m=h.multiInstance;return f}function q(a){"use strict";function d(a){y[a.name]=a}function f(){var a=[];h(y,function(b,c){b.scope===u.scope.eagerSingleton&&a.push(c)}),g(a,!0)}function g(b,c){var d=[];return s(b,function(b){try{var e=j(b);d.push(e)}catch(f){if(!c)throw f;a.logger(f)}}),d}function j(a){var b,c,d;if(!y.hasOwnProperty(a))throw new Error("tried to load "+a+" but was not registered");return b=y[a],c=k(b.scope),d=c(b),d}function k(a){switch(a){case u.scope.multiInstance:return l;case u.scope.lazySingleton:case u.scope.eagerSingleton:return m;default:throw new Error("unknown scope ["+a+"]")}}function l(a){var b,c=n(a.type);return b=c(a),x.push(b),b}function m(a){var b=a.name,d=w[b];return d===c&&(d=l(a),w[b]=d),d}function n(a){switch(a){case u.type.returns:return o;case u.type.creator:return p;default:throw new Error("unknown type ["+a+"]")}}function o(a){return a.returns}function p(d){var f,h,j,k,l=e(b,a.partSettingsSelector.replace(/%partName%/g,d.name)),m={};try{return f=d.dependencies,h=g(f),j=h,(d.settings!==c||l!==c)&&(i(m,d.settings,l),j.unshift(m)),k=d.creator.apply(d,j),k===c&&(k={}),k}catch(n){switch(n.name){case"RangeError":throw n;default:throw new v(d,n)}}}function q(){h(x,function(a){r(a)})}function r(b){if("function"==typeof b.postConstruct){try{b.postConstruct()}catch(c){a.logger("Exception while calling postConstruct",c)}delete b.postConstruct}}function t(a){var b=j(a);return r(b),b}function v(a,b){Error.captureStackTrace&&Error.captureStackTrace(this),this.name="PartCreationException",this.cause=b,this.descriptor=a}var w={},x=[],y={};return v.prototype=Error.prototype,{initEagerSingletons:f,provisionPart:t,getParts:g,provisionFinished:q,addPartDescriptor:d}}function r(){"use strict";function a(a){if(a===c)throw new Error("Published event cannot be undefined");var d="on"+a.name;s(h,function(e){a.name!==c&&b(e,d,a),b(e,g,a)})}function b(a,b,c){var d=a[b];"function"==typeof d&&d.call(a,c)}function d(a){if(a===c)throw new Error("Component to be registered is undefined");if(f(h,a))throw new Error("Component is already registered");h.push(a)}function e(){h=[]}var g="onEvent",h=[];return{publish:a,add:d,reset:e}}d.prototype=Error.prototype;var s=function(){"use strict";function a(a,b){Array.prototype.forEach.call(a,b)}function b(a,b){var c,d,e,f=a.length;for(c=0;f>c&&(d=a[c],!(e=b(d,c,a)));c++);}return Array.prototype.forEach?a:b}(),t=function(){"use strict";function a(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function b(a){return String.prototype.trim.call(a)}return String.prototype.trim?b:a}(),u={scope:{lazySingleton:"lazy-singleton",eagerSingleton:"eager-singleton",multiInstance:"multi-instance"},type:{returns:"returns",creator:"creator"}};moduleSystem=function(a,b,d,e,f,g,h){"use strict";function j(){function k(a){a!==c&&l.mergeWith(a),s.initModulePage()}var l=a(),m=l.get(),n=f(m),o=h(),p=g(n,o,m),q=d(n,m),r=b(p),s=e(p,n,m);return q("event-bus").returns(o),q("eventBus").creator(function(){return console.warn('partName "eventBus" deprecated use "event-bus" instead'),o}),i({createPart:q,createModule:r,initModulePage:k,newInstance:j,getPart:n.provisionPart},u)}return j()}(j,n,p,m,q,o,r)}(window,document);