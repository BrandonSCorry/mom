/**
 * moduleSystem
 * Dynamic Loading of Javascript based on DOM elements
 * @version v1.2.0 - 2015-03-05 * @link 
 * @author Eder Alexander <eder.alexan@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){function d(a,b){"use strict";var c,d,e,f=a.length;for(c=0;f>c&&(d=a[c],!(e=b(c,d)));c++);}function e(a,b){"use strict";var c,d,e=a.length,f=!1;for(c=0;e>c;c++)if(d=a[c],d===b){f=!0;break}return f}function f(a,b){"use strict";var c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],e=b(c,d)))break}function g(){"use strict";var a=arguments[0];return d(arguments,function(b,c){b>0&&f(c,function(b,c){a[b]=c})}),a}function h(){"use strict";function a(a){g(d,a)}function b(){return d}var c={defaultScope:q.scope.multiInstance,settingsSelector:'script[type="%moduleName%/settings"]',attribute:"modules",selector:"[modules]"},d=c;return{get:b,mergeWith:a}}function i(a){"use strict";if("string"!=typeof a)throw new Error("Name missing");return{name:a}}function j(a){"use strict";var b=i(a);return b.type=q.type.creator,b.settings=c,b.dependencies=[],b.creator=c,b}function k(a,c,e){"use strict";function f(){function f(){var f=b.querySelectorAll(e.selector);d(f,function(a,b){g(b)}),c.provisionFinished(),a.provisionFinished()}function g(b){a.provisionModule(b)}f()}return{initModulePage:f}}function l(a,b){"use strict";function d(a){var b=i(a);return b.type=q.type.returns,b.scope=q.scope.singleton,b.returns=c,b}function e(a){var c=j(a);return c.scope=b.defaultScope,c}function f(b){function f(a){k().creator=a,l()}function g(a){m=d(b),m.returns=a,l()}function h(a){var b=k();return a!==c&&(b.scope=a),{settings:i,dependencies:j,creator:f,returns:g}}function i(a){return k().settings=a,{dependencies:j,creator:f}}function j(a){return k().dependencies=a,{settings:i,creator:f}}function k(){return m===c&&(m=e(b)),m}function l(){a.addPartDescriptor(m)}var m;return{settings:i,dependencies:j,creator:f,returns:g,scope:h}}return f}function m(a){"use strict";function b(b){function c(a){g.creator=a,e()}function d(a){return g.settings=a,{dependencies:f,creator:c}}function e(){a.addModuleDescriptor(g)}function f(a){return g.dependencies=a,{settings:d,creator:c}}var g=j(b);return{settings:d,dependencies:f,creator:c}}return b}function n(){"use strict";function a(a){s[a.name]=a}function b(a){var b=[];return d(a,function(a,c){b.push(e(c))}),b}function e(a){var b,c,d;if(!s.hasOwnProperty(a))throw new Error("tried to load "+a+" but was not registered");return b=s[a],c=g(b.scope),d=c(b),d}function g(a){switch(a){case q.scope.multiInstance:return h;case q.scope.singleton:return i;default:throw new Error("unknown scope ["+a+"]")}}function h(a){var b,c=j(a.type);return b=c(a),r.push(b),b}function i(a){var b=a.name,d=p[b];return d===c&&(d=h(a),p[b]=d),d}function j(a){switch(a){case q.type.returns:return k;case q.type.creator:return l;default:throw new Error("unknown type ["+a+"]")}}function k(a){return a.returns}function l(a){var d,e,f,g;return d=a.dependencies,e=b(d),f=e,a.settings!==c&&f.unshift(a.settings),g=a.creator.apply(a,f),g===c&&(g={}),g}function m(){f(r,function(a,b){n(b)})}function n(a){"function"==typeof a.postConstruct&&(a.postConstruct(),delete a.postConstruct)}function o(a){var b=e(a);return n(b),b}var p={},r=[],s={};return{provisionPart:o,getParts:b,provisionFinished:m,addPartDescriptor:a}}function o(a,b,e){"use strict";function f(a){n[a.name]=a}function h(a){var b=a.getAttribute(e.attribute),c=b.split(",");d(c,function(b,c){c=c.trim(),i(a,c)})}function i(b,c){var d,e;if(!n.hasOwnProperty(c))throw new Error("Module "+c+" not registered but found in dom");if(d=n[c],e=a.getParts(d.dependencies),e.length!==d.dependencies.length)throw new Error("Required Parts Missing from "+c+" dependencies: "+JSON.stringify(d.dependencies));j(b,d,e)}function j(a,d,e){var f,h,i=e,j=k(a,d.name);(d.settings!==c||j!==c)&&(f=g({},d.settings,j),i.unshift(f)),i.unshift(a),h=d.creator.apply(d,i),h===c&&(h={}),m.push(h),b.add(h)}function k(a,b){var c,d,f=e.settingsSelector.replace(/%moduleName%/g,b),g=a.querySelector(f);return null!==g&&(c=g.innerHTML,d=JSON.parse(c)),d}function l(){d(m,function(a,b){var c=b.postConstruct;"function"==typeof c&&c.call(b)})}var m=[],n={};return{provisionModule:h,provisionFinished:l,addModuleDescriptor:f}}function p(){"use strict";function a(a){if(a===c)throw new Error("Published event cannot be undefined");var e="on"+a.name;d(i,function(d,f){a.name!==c&&b(f,e,a),b(f,h,a)})}function b(a,b,c){var d=a[b];"function"==typeof d&&d.call(a,c)}function f(a){if(a===c)throw new Error("Component to be registered is undefined");if(e(i,a))throw new Error("Component is already registered");i.push(a)}function g(){i=[]}var h="onEvent",i=[];return{publish:a,add:f,reset:g}}var q={scope:{singleton:"singleton",multiInstance:"multi-instance"},type:{returns:"returns",creator:"creator"}};moduleSystem=function(a,b,d,e,f,g,h){"use strict";function i(){function j(a){return function(b){b!==c&&k.mergeWith(b),a()}}var k=a(),l=k.get(),m=f(),n=h(),o=g(m,n,l),p=d(m,l),q=b(o),r=e(o,m,l);return p("eventBus").creator(function(){return n}),{createPart:p,createModule:q,initModulePage:j(r.initModulePage),newInstance:i,getPart:m.provisionPart}}return i()}(h,m,l,k,n,o,p)}(window,document);