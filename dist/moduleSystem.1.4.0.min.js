/**
 * moduleSystem
 * Dynamic Loading of Javascript based on DOM elements
 * @version v1.4.0 - 2015-04-11 * @link 
 * @author Eder Alexander <eder.alexan@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){function d(a,b,c){"use strict";var d,e,f=b.replace(/%name%/g,c),g=a.querySelector(f);if(null!==g){d=g.innerHTML;try{e=JSON.parse(d)}catch(h){throw new Error("Module ["+c+"] has invalid json in dom. Message: "+h.message)}}return e}function e(a,b){"use strict";var c=!1;return r(a,function(a){return a===b?(c=!0,!0):void 0}),c}function f(a){"use strict";return"[object Array]"===Object.prototype.toString.call(a)}function g(a,b){"use strict";var c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],e=b(d,c)))break}function h(a){"use strict";return r(arguments,function(b,c){c>0&&g(b,function(b,c){a[c]=b})}),a}function i(){"use strict";function a(a){h(e,a)}function c(){return e}var d={rootNode:b,defaultScope:t.scope.multiInstance,moduleSettingsSelector:'script[type="%name%/settings"]',partSettingsSelector:'head script[type="%name%/settings"]',attribute:"modules",selector:"[%attribute%]"},e=d;return{get:c,mergeWith:a}}function j(a){"use strict";if("string"!=typeof a)throw new Error("Name missing");return{name:a}}function k(a){"use strict";var b=j(a);return b.type=t.type.creator,b.settings=c,b.dependencies=[],b.creator=c,b}function l(a,b,c){"use strict";function d(){function d(){var d=c.selector.replace(/%attribute%/g,c.attribute),f=c.rootNode.querySelectorAll(d);b.initEagerSingletons(),r(f,function(a){e(a)}),b.provisionFinished(),a.provisionFinished()}function e(b){a.provisionModule(b)}d()}return{initModulePage:d}}function m(a){"use strict";function b(b){function d(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");i.creator=a,g()}function e(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return i.settings=a,{dependencies:h,creator:d}}function g(){a.addModuleDescriptor(i)}function h(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return i.dependencies=a,{settings:e,creator:d}}var i=k(b);return{settings:e,dependencies:h,creator:d}}return b}function n(a,b,e){"use strict";function f(a){m[a.name]=a}function g(a){var b=a.getAttribute(e.attribute),c=b.split(",");r(c,function(b){b=s(b),i(a,b)})}function i(b,c){var d,e;if(!m.hasOwnProperty(c))throw new Error("Module ["+c+"] not created but found in dom");d=m[c],e=a.getParts(d.dependencies),j(b,d,e)}function j(a,f,g){var i,j=g,k=d(a,e.moduleSettingsSelector,f.name),m={};(f.settings!==c||k!==c)&&(h(m,f.settings,k),j.unshift(m)),j.unshift(a),i=f.creator.apply(f,j),i===c&&(i={}),l.push(i),b.add(i)}function k(){r(l,function(a){"function"==typeof a.postConstruct&&a.postConstruct()})}var l=[],m={};return{provisionModule:g,provisionFinished:k,addModuleDescriptor:f}}function o(a,b){"use strict";function d(a){var b=j(a);return b.type=t.type.returns,b.scope=i,b.returns=c,b}function e(a){var c=k(a);return c.scope=b.defaultScope,c}function g(b){function g(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");o().creator=a,p()}function h(a){if(a===c)throw new Error("You have to pass the returns as one of these object types: string|integer|float|boolean|object|function|Array");q=d(b),q.returns=a,p()}function j(a){if(i!==a&&l!==a&&m!==a)throw new Error("You have to pass the scope as one of these: lazy-singleton|eager-singleton|multi-instance");var b=o();return a!==c&&(b.scope=a),{settings:k,dependencies:n,creator:g,returns:h}}function k(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return o().settings=a,{dependencies:n,creator:g,scope:j}}function n(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return o().dependencies=a,{settings:k,creator:g,scope:j}}function o(){return q===c&&(q=e(b)),q}function p(){a.addPartDescriptor(q)}var q;return{settings:k,dependencies:n,creator:g,returns:h,scope:j}}var h=t.scope,i=h.lazySingleton,l=h.eagerSingleton,m=h.multiInstance;return g}function p(a){"use strict";function e(a){A[a.name]=a}function f(){var a=[];g(A,function(b,c){b.scope===t.scope.eagerSingleton&&a.push(c)}),i(a)}function i(a){var b=[];return r(a,function(a){var c=j(a);b.push(c)}),b}function j(a){var b,c,d;if(!A.hasOwnProperty(a))throw new Error("tried to load "+a+" but was not registered");return k(a),b=A[a],c=m(b.scope),d=c(b),l(a),d}function k(a){var b=!0;if(z.hasOwnProperty(a))throw new Error("Circular dependency detected for part ["+a+"]");z[a]=b}function l(a){delete z[a]}function m(a){switch(a){case t.scope.multiInstance:return n;case t.scope.lazySingleton:case t.scope.eagerSingleton:return o;default:throw new Error("unknown scope ["+a+"]")}}function n(a){var b,c=p(a.type);return b=c(a),y.push(b),b}function o(a){var b=a.name,d=x[b];return d===c&&(d=n(a),x[b]=d),d}function p(a){switch(a){case t.type.returns:return q;case t.type.creator:return s;default:throw new Error("unknown type ["+a+"]")}}function q(a){return a.returns}function s(e){var f,g,j,k,l=d(b,a.partSettingsSelector,e.name),m={};return f=e.dependencies,g=i(f),j=g,(e.settings!==c||l!==c)&&(h(m,e.settings,l),j.unshift(m)),k=e.creator.apply(e,j),k===c&&(k={}),k}function u(){g(y,function(a){v(a)})}function v(a){"function"==typeof a.postConstruct&&(a.postConstruct(),delete a.postConstruct)}function w(a){var b=j(a);return v(b),b}var x={},y=[],z={},A={};return{initEagerSingletons:f,provisionPart:w,getParts:i,provisionFinished:u,addPartDescriptor:e}}function q(){"use strict";function a(a){if(a===c)throw new Error("Published event cannot be undefined");var d="on"+a.name;r(h,function(e){a.name!==c&&b(e,d,a),b(e,g,a)})}function b(a,b,c){var d=a[b];"function"==typeof d&&d.call(a,c)}function d(a){if(a===c)throw new Error("Component to be registered is undefined");if(e(h,a))throw new Error("Component is already registered");h.push(a)}function f(){h=[]}var g="onEvent",h=[];return{publish:a,add:d,reset:f}}var r=function(){"use strict";function a(a,b){Array.prototype.forEach.call(a,b)}function b(a,b){var c,d,e,f=a.length;for(c=0;f>c&&(d=a[c],!(e=b(d,c,a)));c++);}return Array.prototype.forEach?a:b}(),s=function(){"use strict";function a(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function b(a){return String.prototype.trim.call(a)}return String.prototype.trim?b:a}(),t={scope:{lazySingleton:"lazy-singleton",eagerSingleton:"eager-singleton",multiInstance:"multi-instance"},type:{returns:"returns",creator:"creator"}};moduleSystem=function(b,d,e,f,g,i,j){"use strict";function k(){function l(a){a!==c&&m.mergeWith(a),u.initModulePage()}var m=b(),n=m.get(),o=g(n),p=j(),q=i(o,p,n),r=e(o,n),s=d(q),u=f(q,o,n);return r("event-bus").returns(p),r("eventBus").creator(function(){return a.console&&console.warn&&console.warn('partName "eventBus" deprecated use "event-bus" instead'),p}),h({createPart:r,createModule:s,initModulePage:l,newInstance:k,getPart:o.provisionPart},t)}return k()}(i,m,o,l,p,n,q)}(window,document);