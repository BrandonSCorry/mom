/**
 * mom
 * Dynamic Loading of Javascript based on DOM elements
 * @version v1.2.0 - 2015-12-05 * @link 
 * @author mom <https://github.com/momjs/mom>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){function d(a,b,c){"use strict";var d,e,f=a.querySelector(b);if(null!==f){d=f.innerHTML;try{e=JSON.parse(d)}catch(g){throw new Error("Module ["+c+"] has invalid json in dom. Message: "+g.message)}}return e}function e(a,b){"use strict";var c=!1;return w(a,function(a){return a===b?(c=!0,!0):void 0}),c}function f(a){"use strict";return"[object Array]"===Object.prototype.toString.call(a)}function g(a,b){"use strict";var c=a.indexOf(b);return c>-1?(a.splice(c,1),!0):!1}function h(a,b){"use strict";var c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],e=b(d,c)))break}function i(a){"use strict";return w(arguments,function(b,c){c>0&&h(b,function(b,c){a[c]=b})}),a}function j(a,b){"use strict";var c=b||0;setTimeout(a,c)}function k(a,b){"use strict";return a.indexOf(b)>-1}function l(a){"use strict";if("string"!=typeof a)throw new Error("Name missing");return{name:a}}function m(a){"use strict";var b=l(a);return b.type=z.type.creator,b.settings=c,b.dependencies=[],b.creator=c,b}function n(){"use strict";function a(){g.actualSelector=e(g.selector,"attribute",g.attribute),g.mergeWith=f,g.getModuleSettingsSelector=c,g.getPartSettingsSelector=d}function c(a){return e(g.moduleSettingsSelector,"name",a)}function d(a){return e(g.partSettingsSelector,"name",a)}function e(a,b,c){var d,e="%"+b+"%",f=a;return k(a,e)&&(d=new RegExp(e,"g"),f=a.replace(d,c)),f}function f(b){i(g,b),a()}var g={rootNode:b,defaultScope:z.scope.multiInstance,moduleSettingsSelector:'script[type="%name%/settings"],script[type="true/%name%/settings"]',partSettingsSelector:'head script[type="%name%/settings"]',attribute:"modules",selector:"[%attribute%]",domMutationSupport:!1,customIdAttribute:"mom-id"};return a(),g}function o(a,b,c,d){"use strict";function e(){var e=d.actualSelector,g=d.rootNode.querySelectorAll(e);b.initEagerSingletons(),w(g,function(a){f(a)}),d.domMutationSupport===!0&&c.registerToEvents(),b.provisionFinished(),a.provisionFinished()}function f(b){a.provisionModule(b)}return{initModulePage:e,initModule:f}}function p(a){"use strict";function b(b){function d(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");i.creator=a,g()}function e(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return i.settings=a,{dependencies:h,creator:d}}function g(){a.addModuleDescriptor(i)}function h(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return i.dependencies=a,{settings:e,creator:d}}var i=m(b);return{settings:e,dependencies:h,creator:d}}return b}function q(a){"use strict";function b(){return a.customIdAttribute}function c(a,b){var c,e=d(a);g.hasOwnProperty(e)?c=g[e]:(c=[],g[e]=c),c.push(b),h.push(b)}function d(a){var c,d=b();return a.hasAttribute(d)?c=a.getAttribute(d):(c=i(),a.setAttribute(d,c)),c}function e(a){var c,d=b();a.hasAttribute(d)&&(c=a.getAttribute(d),g.hasOwnProperty(c)&&delete g[c])}function f(a){var c=b(),d=a.getAttribute(c);return g[d]||[]}var g={},h=[],i=function(){var a=0;return function(){return++a}}();return h.add=c,h.remove=e,h.get=f,h}function r(a,b,f,g){"use strict";function h(a){q[a.name]=a}function j(a){var b=a.getAttribute(g.attribute),c=b.split(",");w(c,function(b){b=x(b),k(a,b)})}function k(b,c){var d,e;if(!q.hasOwnProperty(c))throw new Error("Module ["+c+"] not created but found in dom");d=q[c],e=a.getParts(d.dependencies),l(b,d,e)}function l(a,e,h){var j,k=h,l=e.name,m=g.getModuleSettingsSelector(l),n=d(a,m,e.name),o={};(e.settings!==c||n!==c)&&(i(o,e.settings,n),k.unshift(o)),k.unshift(a),j=e.creator.apply(e,k),j!==c&&(f.add(a,j),b.add(j))}function m(){w(f,function(a){n(a)})}function n(a){var b=a.postConstruct;"function"==typeof b&&(e(r,b)||(b(),r.push(b)))}function o(a){var c=f.get(a);w(c,function(a){"function"==typeof a.preDestruct&&a.preDestruct()}),w(c,function(a){b.remove(a)}),f.remove(a)}function p(a){var b=q[a];if(!b)throw new Error("tried to load "+a+" module descriptor, but was not registered");return b}var q={},r=[];return{provisionModule:j,unloadModules:o,provisionFinished:m,addModuleDescriptor:h,getModuleDescriptor:p}}function s(c,d,e){"use strict";function f(){var b,c=a.MutationObserver||a.WebKitMutationObserver;return b=c?o(c):p()}function g(a){if(a.nodeType===r&&h(c.rootNode,a)){var b=l(a,c.actualSelector);y(a,c.actualSelector)&&m(a),w(b,function(a){m(a)}),d.provisionFinished(),e.provisionFinished()}}function h(a,c){return a===b?b.body.contains(c):a.contains(c)}function i(a){if(a.nodeType===r){var b=l(a,c.actualSelector);w(b,function(a){n(a)}),y(a,c.actualSelector)&&n(a)}}function k(a,b){g(a),i(b)}function l(a,b){return a.querySelectorAll?a.querySelectorAll(b):[]}function m(a){return d.provisionModule(a)}function n(a){d.unloadModules(a)}function o(a){function b(){h.observe(c.rootNode,f)}function d(){h.takeRecords(),h.disconnect()}function e(a,b){var c,d;w(a,function(a){c=a.addedNodes,d=a.removedNodes,null!==c&&w(c,function(a){g(a)}),null!==d&&w(d,function(a){i(a)})}),b.takeRecords()}var f={attributes:!0,childList:!0,characterData:!0,subtree:!0},h=new a(e);return{register:b,unregister:d}}function p(){function a(){Element.prototype.appendChild=function(a,b){var d=c.call(this,a,b);return j(function(){g(a)}),d},Element.prototype.insertBefore=function(a,b){var c=d.call(this,a,b);return j(function(){g(a)}),c},Element.prototype.removeChild=function(a,b){var c=e.call(this,a,b);return j(function(){i(a)}),c},Element.prototype.replaceChild=function(a,b){var c=f.call(this,a,b);return j(function(){k(a,b)}),c}}function b(){Element.prototype.appendChild=function(a,b){return c.call(this,a,b)},Element.prototype.insertBefore=function(a,b){return d.call(this,a,b)},Element.prototype.removeChild=function(a,b){return e.call(this,a,b)},Element.prototype.replaceChild=function(a,b){return f.call(this,a,b)}}var c=Element.prototype.appendChild,d=Element.prototype.insertBefore,e=Element.prototype.removeChild,f=Element.prototype.replaceChild;return{register:a,unregister:b}}var q=f(),r=a.Node?Node.ELEMENT_NODE:1;return{registerToEvents:q.register,unregisterToEvents:q.unregister}}function t(a,b){"use strict";function d(b){function d(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");o().creator=a,p()}function h(a){if(a===c)throw new Error("You have to pass the returns as one of these object types: string|integer|float|boolean|object|function|Array");q=e(b),q.returns=a,p()}function l(a){if(i!==a&&j!==a&&k!==a)throw new Error("You have to pass the scope as one of these: lazy-singleton|eager-singleton|multi-instance");var b=o();return a!==c&&(b.scope=a),{settings:m,dependencies:n,creator:d,returns:h}}function m(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return o().settings=a,{dependencies:n,creator:d,scope:l}}function n(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return o().dependencies=a,{settings:m,creator:d,scope:l}}function o(){return q===c&&(q=g(b)),q}function p(){a.addPartDescriptor(q)}var q;return{settings:m,dependencies:n,creator:d,returns:h,scope:l}}function e(a){var b=l(a);return b.type=z.type.returns,b.scope=i,b.returns=c,b}function g(a){var c=m(a);return c.scope=b.defaultScope,c}var h=z.scope,i=h.lazySingleton,j=h.eagerSingleton,k=h.multiInstance;return d}function u(f){"use strict";function g(a){D[a.name]=a}function j(){var a=[];h(D,function(b,c){b.scope===z.scope.eagerSingleton&&a.push(c)}),k(a)}function k(a){var b=[];return w(a,function(a){var c=l(a);b.push(c)}),b}function l(b){var c,d,e;if(D.hasOwnProperty(b))m(b),c=D[b],d=o(c.scope),e=d(c),n(b);else{if(!a||!a[b])throw new Error("tried to load "+b+" but was not registered");c={name:b,scope:z.scope.eagerSingleton,type:z.type.returns,returns:a[b]},e=q(c)}return e}function m(a){var b=!0;if(C.hasOwnProperty(a))throw new Error("Circular dependency detected for part ["+a+"]");C[a]=b}function n(a){delete C[a]}function o(a){switch(a){case z.scope.multiInstance:return p;case z.scope.lazySingleton:case z.scope.eagerSingleton:return q;default:throw new Error("unknown scope ["+a+"]")}}function p(a){var b,c=r(a.type);return b=c(a),B.push(b),b}function q(a){var b=a.name,d=A[b];return d===c&&(d=p(a),A[b]=d),d}function r(a){switch(a){case z.type.returns:return s;case z.type.creator:return t;default:throw new Error("unknown type ["+a+"]")}}function s(a){return a.returns}function t(a){var e,g,h,j,l=a.name,m=f.getPartSettingsSelector(l),n=d(b,m,a.name),o={};return e=a.dependencies,g=k(e),h=g,(a.settings!==c||n!==c)&&(i(o,a.settings,n),h.unshift(o)),j=a.creator.apply(a,h),j===c&&(j={}),j}function u(){h(B,function(a){v(a)})}function v(a){var b=a.postConstruct;"function"==typeof b&&(e(E,b)||(b(),E.push(b)))}function x(a){var b=l(a);return v(b),b}function y(a){var b=D[a];if(!b)throw new Error("tried to load "+a+" part descriptor, but was not registered");return b}var A={},B=[],C={},D={},E=[];return{initEagerSingletons:j,getPartDescriptor:y,provisionPart:x,getParts:k,provisionFinished:u,addPartDescriptor:g}}function v(){"use strict";function a(a){if(a===c)throw new Error("Published event cannot be undefined");var d="on"+a.name;w(j,function(e){a.name!==c&&b(e,d,a),b(e,i,a)})}function b(a,b,c){var d=a[b];"function"==typeof d&&d.call(a,c)}function d(a){if(a===c)throw new Error("Listener to be registered is undefined");if(e(j,a))throw new Error("Listener is already registered");j.push(a)}function f(a){if(a===c)throw new Error("Listener to be removed is undefined");var b=g(j,a);if(!b)throw new Error("Listener to be removed is not registered")}function h(){j=[]}var i="onEvent",j=[];return{publish:a,add:d,remove:f,reset:h}}var w=function(){"use strict";function a(a,b){Array.prototype.forEach.call(a,b)}function b(a,b){var c,d,e,f=a.length;for(c=0;f>c&&(d=a[c],!(e=b(d,c,a)));c++);}return Array.prototype.forEach?a:b}(),x=function(){"use strict";function a(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function b(a){return String.prototype.trim.call(a)}return String.prototype.trim?b:a}(),y=function(){"use strict";function a(a,b){return d.call(a,b)}function b(a,b){var c=a.parentNode||a.document,d=c.querySelectorAll(b);return e(d,a)}var c=Element.prototype,d=c.matches||c.matchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector||c.webkitMatchesSelector;return d?a:b}(),z={scope:{lazySingleton:"lazy-singleton",eagerSingleton:"eager-singleton",multiInstance:"multi-instance"},type:{returns:"returns",creator:"creator"}};mom=function(){"use strict";function a(){function b(a){a!==c&&e.mergeWith(a),w.initModulePage()}function d(){m!==c&&m.unregisterToEvents(),g.reset()}var e=n(),f=u(e),g=v(),h=q(e),j=r(f,g,h,e),k=t(f,e),l=p(j),m=s(e,j,f),w=o(j,f,m,e);return k("event-bus").returns(g),i({createPart:k,createModule:l,provisionDomElement:j.provisionModule,initModulePage:b,newInstance:a,dispose:d,getPart:f.provisionPart,getPartDescriptor:f.getPartDescriptor,getModuleDescriptor:j.getModuleDescriptor},z)}return a()}()}(window,document);