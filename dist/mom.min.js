/**
 * mom
 * Dynamic Loading of Javascript based on DOM elements
 * @version v1.0.0 - 2015-05-06 * @link 
 * @author mom <https://github.com/momjs/mom>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){function d(a,b,c){"use strict";var d,e,f=a.querySelector(b);if(null!==f){d=f.innerHTML;try{e=JSON.parse(d)}catch(g){throw new Error("Module ["+c+"] has invalid json in dom. Message: "+g.message)}}return e}function e(a,b){"use strict";var c=!1;return w(a,function(a){return a===b?(c=!0,!0):void 0}),c}function f(a){"use strict";return"[object Array]"===Object.prototype.toString.call(a)}function g(a,b){"use strict";var c=a.indexOf(b);return c>-1?(a.splice(c,1),!0):!1}function h(a,b){"use strict";var c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],e=b(d,c)))break}function i(a){"use strict";return w(arguments,function(b,c){c>0&&h(b,function(b,c){a[c]=b})}),a}function j(a,b){"use strict";var c=b||0;setTimeout(a,c)}function k(a,b){"use strict";return a.indexOf(b)>-1}function l(a){"use strict";if("string"!=typeof a)throw new Error("Name missing");return{name:a}}function m(a){"use strict";var b=l(a);return b.type=z.type.creator,b.settings=c,b.dependencies=[],b.creator=c,b}function n(){"use strict";function a(){g.actualSelector=e(g.selector,"attribute",g.attribute),g.mergeWith=f,g.getModuleSettingsSelector=c,g.getPartSettingsSelector=d}function c(a){return e(g.moduleSettingsSelector,"name",a)}function d(a){return e(g.partSettingsSelector,"name",a)}function e(a,b,c){var d,e="%"+b+"%",f=a;return k(a,e)&&(d=new RegExp(e,"g"),f=a.replace(d,c)),f}function f(b){i(g,b),a()}var g={rootNode:b,defaultScope:z.scope.multiInstance,moduleSettingsSelector:'script[type="%name%/settings"],script[type="true/%name%/settings"]',partSettingsSelector:'head script[type="%name%/settings"]',attribute:"modules",selector:"[%attribute%]",domMutationSupport:!1,customIdAttribute:"mom-id"};return a(),g}function o(a,b,c){"use strict";function d(){var d=c.actualSelector,f=c.rootNode.querySelectorAll(d);b.initEagerSingletons(),w(f,function(a){e(a)}),b.provisionFinished(),a.provisionFinished()}function e(b){a.provisionModule(b)}return{initModulePage:d,initModule:e}}function p(a){"use strict";function b(b){function d(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");i.creator=a,g()}function e(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return i.settings=a,{dependencies:h,creator:d}}function g(){a.addModuleDescriptor(i)}function h(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return i.dependencies=a,{settings:e,creator:d}}var i=m(b);return{settings:e,dependencies:h,creator:d}}return b}function q(a){"use strict";function b(){return a.customIdAttribute}function c(a,b){var c,e=d(a);g.hasOwnProperty(e)?c=g[e]:(c=[],g[e]=c),c.push(b),h.push(b)}function d(a){var c,d=b();return a.hasAttribute(d)?c=a.getAttribute(d):(c=i(),a.setAttribute(d,c)),c}function e(a){var c,d=b();a.hasAttribute(d)&&(c=a.getAttribute(d),g.hasOwnProperty(c)&&delete g[c])}function f(a){var c=b(),d=a.getAttribute(c);return g[d]||[]}var g={},h=[],i=function(){var a=0;return function(){return++a}}();return h.add=c,h.remove=e,h.get=f,h}function r(a,b,f,g){"use strict";function h(a){p[a.name]=a}function j(a){var b=a.getAttribute(g.attribute),c=b.split(",");w(c,function(b){b=x(b),k(a,b)})}function k(b,c){var d,e;if(!p.hasOwnProperty(c))throw new Error("Module ["+c+"] not created but found in dom");d=p[c],e=a.getParts(d.dependencies),l(b,d,e)}function l(a,e,h){var j,k=h,l=e.name,m=g.getModuleSettingsSelector(l),n=d(a,m,e.name),o={};(e.settings!==c||n!==c)&&(i(o,e.settings,n),k.unshift(o)),k.unshift(a),j=e.creator.apply(e,k),j!==c&&(f.add(a,j),b.add(j))}function m(){w(f,function(a){n(a)})}function n(a){var b=a.postConstruct;"function"==typeof b&&(e(q,b)||(b(),q.push(b)))}function o(a){var c=f.get(a);w(c,function(a){"function"==typeof a.preDestruct&&a.preDestruct()}),w(c,function(a){b.remove(a)}),f.remove(a)}var p={},q=[];return{provisionModule:j,unloadModules:o,provisionFinished:m,addModuleDescriptor:h}}function s(c,d,e){"use strict";function f(){var b,c=a.MutationObserver||a.WebKitMutationObserver;return b=c?o(c):p()}function g(a){if(h(c.rootNode,a)){var b=l(a,c.actualSelector);y(a,c.actualSelector)&&m(a),w(b,function(a){m(a)}),d.provisionFinished(),e.provisionFinished()}}function h(a,c){return a===b?b.body.contains(c):a.contains(c)}function i(a){var b=l(a,c.actualSelector);w(b,function(a){n(a)}),y(a,c.actualSelector)&&n(a)}function k(a,b){g(a),i(b)}function l(a,b){return a.querySelectorAll?a.querySelectorAll(b):[]}function m(a){return d.provisionModule(a)}function n(a){d.unloadModules(a)}function o(a){function b(){h.observe(c.rootNode,f)}function d(){h.takeRecords(),h.disconnect()}function e(a,b){var c,d;w(a,function(a){c=a.addedNodes,d=a.removedNodes,null!==c&&w(c,function(a){g(a)}),null!==d&&w(d,function(a){i(a)})}),b.takeRecords()}var f={attributes:!0,childList:!0,characterData:!0,subtree:!0},h=new a(e);return{register:b,unregister:d}}function p(){function a(){Element.prototype.appendChild=function(a,b){var d=c.call(this,a,b);return j(function(){g(a)}),d},Element.prototype.insertBefore=function(a,b){var c=d.call(this,a,b);return j(function(){g(a)}),c},Element.prototype.removeChild=function(a,b){var c=e.call(this,a,b);return j(function(){i(a)}),c},Element.prototype.replaceChild=function(a,b){var c=f.call(this,a,b);return j(function(){k(a,b)}),c}}function b(){Element.prototype.appendChild=function(a,b){return c.call(this,a,b)},Element.prototype.insertBefore=function(a,b){return d.call(this,a,b)},Element.prototype.removeChild=function(a,b){return e.call(this,a,b)},Element.prototype.replaceChild=function(a,b){return f.call(this,a,b)}}var c=Element.prototype.appendChild,d=Element.prototype.insertBefore,e=Element.prototype.removeChild,f=Element.prototype.replaceChild;return{register:a,unregister:b}}var q=f();return{registerToEvents:q.register,unregisterToEvents:q.unregister}}function t(a,b){"use strict";function d(a){var b=l(a);return b.type=z.type.returns,b.scope=i,b.returns=c,b}function e(a){var c=m(a);return c.scope=b.defaultScope,c}function g(b){function g(a){if("function"!=typeof a)throw new Error("You have to pass the creator as a reference to a function");o().creator=a,p()}function h(a){if(a===c)throw new Error("You have to pass the returns as one of these object types: string|integer|float|boolean|object|function|Array");q=d(b),q.returns=a,p()}function l(a){if(i!==a&&j!==a&&k!==a)throw new Error("You have to pass the scope as one of these: lazy-singleton|eager-singleton|multi-instance");var b=o();return a!==c&&(b.scope=a),{settings:m,dependencies:n,creator:g,returns:h}}function m(a){if(a!==c&&"object"!=typeof a)throw new Error("You have to pass the settings as an object");return o().settings=a,{dependencies:n,creator:g,scope:l}}function n(a){if(a!==c&&!f(a))throw new Error("You have to pass the dependencies as an Array");return o().dependencies=a,{settings:m,creator:g,scope:l}}function o(){return q===c&&(q=e(b)),q}function p(){a.addPartDescriptor(q)}var q;return{settings:m,dependencies:n,creator:g,returns:h,scope:l}}var h=z.scope,i=h.lazySingleton,j=h.eagerSingleton,k=h.multiInstance;return g}function u(a){"use strict";function f(a){B[a.name]=a}function g(){var a=[];h(B,function(b,c){b.scope===z.scope.eagerSingleton&&a.push(c)}),j(a)}function j(a){var b=[];return w(a,function(a){var c=k(a);b.push(c)}),b}function k(a){var b,c,d;if(!B.hasOwnProperty(a))throw new Error("tried to load "+a+" but was not registered");return l(a),b=B[a],c=n(b.scope),d=c(b),m(a),d}function l(a){var b=!0;if(A.hasOwnProperty(a))throw new Error("Circular dependency detected for part ["+a+"]");A[a]=b}function m(a){delete A[a]}function n(a){switch(a){case z.scope.multiInstance:return o;case z.scope.lazySingleton:case z.scope.eagerSingleton:return p;default:throw new Error("unknown scope ["+a+"]")}}function o(a){var b,c=q(a.type);return b=c(a),y.push(b),b}function p(a){var b=a.name,d=x[b];return d===c&&(d=o(a),x[b]=d),d}function q(a){switch(a){case z.type.returns:return r;case z.type.creator:return s;default:throw new Error("unknown type ["+a+"]")}}function r(a){return a.returns}function s(e){var f,g,h,k,l=e.name,m=a.getPartSettingsSelector(l),n=d(b,m,e.name),o={};return f=e.dependencies,g=j(f),h=g,(e.settings!==c||n!==c)&&(i(o,e.settings,n),h.unshift(o)),k=e.creator.apply(e,h),k===c&&(k={}),k}function t(){h(y,function(a){u(a)})}function u(a){var b=a.postConstruct;"function"==typeof b&&(e(C,b)||(b(),C.push(b)))}function v(a){var b=k(a);return u(b),b}var x={},y=[],A={},B={},C=[];return{initEagerSingletons:g,provisionPart:v,getParts:j,provisionFinished:t,addPartDescriptor:f}}function v(){"use strict";function a(a){if(a===c)throw new Error("Published event cannot be undefined");var d="on"+a.name;w(j,function(e){a.name!==c&&b(e,d,a),b(e,i,a)})}function b(a,b,c){var d=a[b];"function"==typeof d&&d.call(a,c)}function d(a){if(a===c)throw new Error("Listener to be registered is undefined");if(e(j,a))throw new Error("Listener is already registered");j.push(a)}function f(a){if(a===c)throw new Error("Listener to be removed is undefined");var b=g(j,a);if(!b)throw new Error("Listener to be removed is not registered")}function h(){j=[]}var i="onEvent",j=[];return{publish:a,add:d,remove:f,reset:h}}var w=function(){"use strict";function a(a,b){Array.prototype.forEach.call(a,b)}function b(a,b){var c,d,e,f=a.length;for(c=0;f>c&&(d=a[c],!(e=b(d,c,a)));c++);}return Array.prototype.forEach?a:b}(),x=function(){"use strict";function a(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function b(a){return String.prototype.trim.call(a)}return String.prototype.trim?b:a}(),y=function(){"use strict";function a(a,b){return d.call(a,b)}function b(a,b){var c=a.parentNode||a.document,d=c.querySelectorAll(b);return e(d,a)}var c=Element.prototype,d=c.matches||c.matchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector||c.webkitMatchesSelector;return d?a:b}(),z={scope:{lazySingleton:"lazy-singleton",eagerSingleton:"eager-singleton",multiInstance:"multi-instance"},type:{returns:"returns",creator:"creator"}};mom=function(){"use strict";function b(){function d(a){a!==c&&f.mergeWith(a),w.initModulePage(),f.domMutationSupport===!0&&x.registerToEvents()}function e(){x!==c&&x.unregisterToEvents(),h.reset()}var f=n(),g=u(f),h=v(),j=q(f),k=r(g,h,j,f),l=t(g,f),m=p(k),w=o(k,g,f),x=s(f,k,g);return l("event-bus").returns(h),l("eventBus").creator(function(){return a.console&&console.warn&&console.warn('partName "eventBus" deprecated use "event-bus" instead'),h}),i({createPart:l,createModule:m,initModulePage:d,newInstance:b,dispose:e,getPart:g.provisionPart},z)}return b()}()}(window,document);