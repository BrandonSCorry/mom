/**
 * moduleSystem
 * Dynamic Loading of Javascript based on DOM elements
 * @version v0.3.2 - 2014-09-25 * @link 
 * @author Eder Alexander <eder.alexan@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */var moduleLoader=function(a){"use strict";function b(){function a(){var a,b,c,d,h,i,j,k,l=[];for(a in e)e.hasOwnProperty(a)&&(b=e[a],l.push(b));if(l.length>0){do for(j=l,l=[],c=0;c<j.length;c++)b=j[c],d=b.dependencies,h=f(d),h.length===d.length?(k=h,void 0!==b.settings&&k.unshift(b.settings),i=b.creator.apply(null,k),g[b.name]=i):l.push(b);while(j.length>l.length);if(l.length>0)throw new Error("provision error can't resolve dependencies for parts:"+JSON.stringify(l))}}function b(){function a(a,b){var c=a.find('script[type="'+b+'/settings"]'),d=c.html();return void 0!==d?$.parseJSON(d):void 0}var b,e,g=$("[data-module]");g.each(function(b,e){var g,i,j,k,l,m,n,o,p,q=$(e),r=q.data("module").split(",");for(l=0;l<r.length;l++){if(g=r[l],!d.hasOwnProperty(g))throw new Error("Module "+g+" not registered but found in dom");if(i=d[g],m=f(i.dependencies),m.length!==i.dependencies.length)throw new Error("Required Parts Missing from "+g+" dependencies: "+JSON.stringify(i.dependencies));n=m,o=a(q,g),(void 0!==i.settings||void 0!==o)&&(p=$.extend({},i.settings,o),n.unshift(p)),n.unshift(q),j=i.creator.apply(null,n),void 0===j&&(j={}),k=c(i.name),j.name=k,h[k]=j,eventBus.add(j)}});for(b in h)h.hasOwnProperty(b)&&(e=h[b],"function"==typeof e.postConstruct&&e.postConstruct())}function c(a){var b,c=0;do b=a+c,c++;while(h.hasOwnProperty(b));return b}function f(a){var b=[];return a.length>0&&$.each(a,function(){if(g.hasOwnProperty(this)){var a=g[this];b.push(a)}}),b}var g={},h={};a(),b()}function c(){function a(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b]}a(e),a(d)}var d=a.modules,e=a.parts;return{initModulePage:b,reset:c}},moduleBuilder=function(){"use strict";function a(a){return function(b){function c(c){var d={creator:c,name:b,dependencies:g,settings:f};if(a.hasOwnProperty(b))throw new Error(b+" already registered");a[b]=d}function d(a){return f=a,{dependencies:e,creator:c}}function e(a){return $.isArray(a)||(a=[a]),g=a,{settings:d,creator:c}}if("string"!=typeof b)throw new Error("Name missing");var f,g=[];return{settings:d,dependencies:e,creator:c}}}function b(){function a(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b]}a(d),a(c)}var c={},d={};return{createPart:a(d),createModule:a(c),modules:c,parts:d,reset:b}},eventBus=function(){"use strict";function a(a){this.name=a,this.getData=function(){var a={};for(var b in this)this.hasOwnProperty(b)&&"name"!==b&&"getData"!==b&&(a[b]=this[b]);return a}}function b(a,b){if("undefined"!=typeof a&&"undefined"!=typeof a.name){var c,d,e,g="on"+a.name;for(c in f)f.hasOwnProperty(c)&&(d=f[c],e=d[g],"function"==typeof e&&(b=b||d,e.call(b,a.getData())))}}function c(a,b){if("undefined"==typeof a)throw new Error("Component to be registered is undefined");if("undefined"==typeof a.name)throw new Error("Component name to be registered is undefined");if(a.name in f){if(!b)throw new Error("Component with name ["+a.name+"] already registered");d(a.name)}f[a.name]=a}function d(a){a in f&&delete f[a]}function e(){f={}}var f={},g=new a,h={register:function(a,b){if("function"!=typeof a)throw new Error("No Event provided");if(b in h)throw new Error("Error registering event, duplicate Event with name ["+b+"]");return a.prototype=g,h[b]=a,a}};return{publish:b,add:c,remove:d,reset:e,Events:h}}(),moduleSystem=function(a,b,c){"use strict";function d(){e.reset(),f.reset()}var e=a(),f=b(e,c);return e.createPart("eventBus").creator(function(){return c}),{createPart:e.createPart,createModule:e.createModule,initModulePage:f.initModulePage,reset:d}}(moduleBuilder,moduleLoader,eventBus);